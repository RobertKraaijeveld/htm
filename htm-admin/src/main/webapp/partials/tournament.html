<!--tournament.html-->
<div ng-controller="TournamentCtrl">
	<div class="container container-fluid">
		<div class="row">
			<div class="page-header">
				<h2><span>{{tournament.name}}</span>
					
				  	<div class="btn-group pull-right">
					  	<div class="btn-group">
					  		<button  role="button" class="btn btn-default dropdown-toggle"
						data-toggle="dropdown">
								<span class="glyphicon glyphicon-random"></span> 
								<span>Phases</span>
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu pull-left">
								<li><a href="" ng-click="showFreestyle()">Freestyle</a></li>
								<li><a href="" ng-click="showPools()">Pool</a></li>
								<li><a href="" ng-click="showElimination()">Elimination</a></li>
							</ul>
						</div>
					  	<div class="btn-group">
					  		<button  role="button" class="btn btn-default dropdown-toggle"
						data-toggle="dropdown">
								<span class="glyphicon glyphicon-download"></span> 
								<span>Download</span>
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu pull-right">
								<!--TODO: Implement links-->
								<li><a href="/download/pools">Pools</a></li>
								<li><a href="/download/schedule">Schedule</a></li>
							</ul>
						</div>
					</div>
				</h2>
			</div>
		</div>
		<!-- Participants table and search/add menu -->
		<div class="row">
			<div class="col-md-12">
				<table class="table table-striped table-condensed table-hover table-responsive">
					<thead>
						<tr>
							<th>Checks</th>
							<th>Number</th>
							<th>Country</th>
							<th>Name</th>
							<th>Club</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="participant in tournament.participants" ng-init="subscription = participant.getSubscription(tournament.id)">
							<td>
								<span>
								    <span class="label" ng-class="subscription.isPresent ? 'label-success' : 'label-danger'" title="{{subscription.isPresent ? 'Checked in' : 'Not checked in yet'}}">
								    	<span class="glyphicon glyphicon-check"></span>
								    </span>
								    <span class="label" ng-class="subscription.droppedOut ? 'label-danger' : 'label-success'" title="{{subscription.droppedOut ? 'Dropped out' : 'In tournament'}}">
								    	<span class="glyphicon glyphicon-heart"></span>
								    </span>
									<span class="label" ng-class="subscription.gearChecked ? 'label-success' : 'label-danger'" title="{{subscription.gearChecked ? 'Gear checked' : 'Gear not checked'}}"><span class="glyphicon glyphicon-cog"></span>
									</span>								    
						    	</span>
							</td>
							<td>{{subscription.fighterNumber}}</td>
							<td><htm-flag country="participant.country"></htm-flag></td>
							<td>{{participant.name}}</td>
							<td>{{participant.club.name}}</td>
						</tr>
					</tbody>
				</table>

				<span class="input-group">
					<span class="input-group-addon">
							<span class="glyphicon glyphicon-search" title="Search participant"></span>
					</span>
					<ui-select ng-model="newPartipcant.selected" focus-on="newParticipantAdded" >
						<ui-select-match placeholder="Select or search a participant in the list...">
							<span>
								<htm-flag country="newPartipcant.selected.country"></htm-flag>
								<span> {{newPartipcant.selected.name + " - " + newPartipcant.selected.club.name}}</span> 
							</span>
							</ui-select-match>
						<ui-select-choices repeat="participant in participants | filter: $select.search" refresh="searchParticipants($select.search)"refresh-delay="500">
							<span><htm-flag country="participant.country"></htm-flag>
							<span ng-bind-html="participant.name | highlight: $select.search"></span> - <span ng-bind-html="participant.club.name | highlight: $select.search"></span></span>
						</ui-select-choices>
					</ui-select>
					<span class="input-group-btn">
						<button role="button" class="btn btn-default" ng-click="addParticipant(newPartipcant.selected); $broadcast('newParticipantAdded');" ng-disabled="!newPartipcant.selected"  htm-focus-on="newPartipcant.selected">
							<span class="glyphicon glyphicon-plus" title="Add participant to tournament"></span>
						</button>
					</span>
				</span>
			</div>
		</div>
		<!-- Phases  -->
		<div class="row" ng-repeat="phase in tournament.phases">
			<div class="col-md-12">
				<!-- Free style phase -->
				<div ng-show="phase.phaseType === 'F'">
					<div class="page-header">
						<h3>
							<span>{{phase.name}}</span>
							<div class="pull-right">
								<div class="btn-group ">
									<button role="button" ng-click="addFight(phase)" role="button" class="btn btn-default">
										<span class="glyphicon glyphicon-plus"></span>Add Fight</span>
									</button>
								</div>
							</div>
						</h3>
					</div>
					<div class="col-xs-6 col-md-4" ng-repeat="fight in tournament.getFights(phase.fights)">
						<htm-fight-panel fight="fight" tournament="tournament"></htm-fight-panel>
					</div>
				</div>
				<!-- Pool phase -->
				<div ng-show="phase.phaseType === 'P'">
					<div class="page-header">
						<h3>{{phase.name}}</h3>
					</div>
					<div class="panel panel-default" ng-repeat="pool in phase.pools">
						<div class="panel-heading">
							<h3 class="panel-title">{{pool.name}}</h3>
						</div>
						<div class="panel-body" >
							<div class="col-xs-6 col-md-4" ng-repeat="fight in tournament.getFights(pool.fights)">
								<htm-fight-panel fight="fight" tournament="tournament"></htm-fight-panel>
							</div>
						</div>
					</div>
				</div>
				<!-- Elimination phase -->
				<div ng-show="phase.phaseType === 'E'">
					<div class="page-header">
						<h3>{{phase.name}}</h3>
					</div>
					<div class="col-xs-6 col-md-4" ng-repeat="fight in tournament.getFights(phase.fights)">
						<htm-fight-panel fight="fight" tournament="tournament"></htm-fight-panel>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

